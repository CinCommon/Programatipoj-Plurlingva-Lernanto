![image-20230730190608077](/Users/stevenyin/Documents/storage/学习笔记/Terraform/image-20230730190608077.png)

Terraform state is a file that keeps track of the resources managed by Terraform in your infrastructure. By default it is stored locally as `terraform.tfstate`, but it can also be stored remotely in a backend like S3.

Here are some tips on using remote state in S3:

**Configure S3 backend**

In `terraform.tf` configure the S3 backend:

```terraform
terraform {
  backend "s3" {
    bucket = "mybucket" 
    key    = "path/to/terraform.tfstate"
    region = "us-east-1" 
  }
}
```

This stores state in an S3 bucket instead of locally.

**Manage state locking** 

The S3 backend supports state locking to prevent concurrent operations. Enable it:

```
terraform {
  backend "s3" {
    dynamodb_table = "terraform_locks"
    encrypt        = true
  }
}
```

This will use DynamoDB for locking.

**Share state across a team**

With S3 state, a team can share the same remote state file. Ensure everyone configures the same backend.

**Prevent state corruption**

Remote state prevents accidental destruction of state since it can be recovered from S3. 

**Separate environments** 

Use separate buckets/paths per environment like dev, staging, prod to isolate state.

**Limit access**

Use IAM policies on the S3 bucket to restrict access to the Terraform state file.

**Versioning**

Enable versioning on the S3 bucket to preserve history of the state file.

So in summary, S3 provides a scalable, secure and shareable backend for Terraform state, enabling collaboration and protecting state integrity. The key is configuring the backend correctly and managing permissions properly.
